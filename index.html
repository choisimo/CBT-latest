<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마음 일기 API 명세서</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Tailwind gray-50 */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4 {
            color: #1f2937; /* Tailwind gray-800 */
            margin-bottom: 0.75em;
        }
        h1 { font-size: 2.25rem; font-weight: 700; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        h2 { font-size: 1.875rem; font-weight: 600; margin-top: 2.5rem; border-bottom: 1px solid #d1d5db; padding-bottom: 0.5rem;}
        h3 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; }
        h4 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        th, td {
            border: 1px solid #e5e7eb; /* Tailwind gray-200 */
            padding: 0.75rem 1rem;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #f3f4f6; /* Tailwind gray-100 */
            font-weight: 600;
            color: #374151; /* Tailwind gray-700 */
        }
        td:first-child {
            font-weight: 500;
            width: 25%;
            color: #4b5563; /* Tailwind gray-600 */
        }
        pre {
            background-color: #1f2937; /* Tailwind gray-800 */
            color: #d1d5db; /* Tailwind gray-300 */
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            font-size: 0.875rem;
            line-height: 1.6;
            margin-top: 0.5rem;
        }
        code {
            font-family: 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", monospace;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li a {
            text-decoration: none;
            color: #2563eb; /* Tailwind blue-600 */
            transition: color 0.3s ease;
        }
        .toc li a:hover {
            color: #1d4ed8; /* Tailwind blue-700 */
            text-decoration: underline;
        }
        .badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: 0.75em;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }
        .badge-get { background-color: #22c55e; color: white; } /* Tailwind green-500 */
        .badge-post { background-color: #3b82f6; color: white; } /* Tailwind blue-500 */
        .badge-put { background-color: #f59e0b; color: white; } /* Tailwind amber-500 */
        .badge-delete { background-color: #ef4444; color: white; } /* Tailwind red-500 */

        /* Navigation styles */
        .nav-container {
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 50;
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-menu {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem; /* For scrollbar space if needed */
            white-space: nowrap;
        }
        .nav-menu a {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            text-decoration: none;
            color: #374151; /* Tailwind gray-700 */
            font-weight: 500;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .nav-menu a:hover, .nav-menu a.active {
            background-color: #e0e7ff; /* Tailwind indigo-100 */
            color: #4338ca; /* Tailwind indigo-700 */
        }

        /* Scrollspy active state for TOC */
        .toc-item.active > a {
            font-weight: bold;
            color: #1d4ed8; /* Tailwind blue-700 */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="nav-container">
        <div class="container">
            <nav id="top-nav" class="nav-menu">
                </nav>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>마음 일기 API 명세서 (Auth 서버 및 연관 API 중심)</h1>
        </header>

        <aside class="toc bg-white p-6 rounded-lg shadow mb-8 float-left mr-8 w-1/4 sticky top-28">
            <h2 class="text-xl font-semibold mb-4">목차</h2>
            <ul id="toc-list">
                </ul>
        </aside>

        <main class="w-3/4 float-right">
            <section id="api-개요">
                <h2>1. API 개요</h2>
                <table>
                    <thead>
                        <tr>
                            <th>항목</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>기본 URL</td>
                            <td><code>https://your-api-domain.com</code></td>
                        </tr>
                        <tr>
                            <td>버전</td>
                            <td>v1.2</td>
                        </tr>
                        <tr>
                            <td>인증 방식</td>
                            <td>Bearer Token (JWT)</td>
                        </tr>
                        <tr>
                            <td>응답 형식</td>
                            <td>JSON</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="인증-api">
                <h2>2. 인증 API</h2>
                <article id="인증-상태-확인">
                    <h3>2.1. 인증 상태 확인 (테스트용)</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/auth_check</code></td></tr>
                        <tr><td>설명</td><td>현재 요청이 유효한 인증 토큰을 가지고 있는지 확인합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>응답 코드</td><td>200: 인증됨<br>401: 인증되지 않음</td></tr>
                    </table>
                </article>
                <article id="jwt-토큰-재발급">
                    <h3>2.2. JWT 토큰 재발급</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/auth/api/protected/refresh</code></td></tr>
                        <tr><td>설명</td><td>만료된 Access Token과 유효한 Refresh Token을 사용하여 새로운 Access Token을 발급받습니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "expiredToken": "string",
  "provider": "string" // 예: "server", "google"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 토큰 재발급 성공<br>401: Refresh Token이 없거나 유효하지 않음<br>406: 요청이 유효하지 않거나 Redis에 Refresh Token이 없음</td></tr>
                        <tr><td>응답 헤더</td><td>Authorization: Bearer {새로운 액세스 토큰}</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "access_token": "new_eyJhbGciOiJIUzUxMiJ9..."
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="사용자-관리-api">
                <h2>3. 사용자 관리 API</h2>
                <article id="회원-가입">
                    <h3>3.1. 회원 가입</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/join</code></td></tr>
                        <tr><td>설명</td><td>새로운 사용자를 등록합니다. 이메일 인증 코드가 사전에 검증되어야 합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "userId": "newUser123",
  "userPw": "password123!",
  "userName": "홍길동",
  "nickname": "쾌활한다람쥐",
  "phone": "010-1234-5678",
  "email": "user@example.com",
  "role": "USER", // 기본값: USER
  "birthDate": "1990-01-01",
  "gender": "male",
  "isPrivate": false,
  "profile": "https://zrr.kr/iPHf", // 프로필 이미지 URL
  "code": "A1B2C3D4" // 이메일 인증 코드
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 회원 가입 성공<br>400: 잘못된 요청<br>409: 충돌 (이미 존재하는 아이디/닉네임)<br>500: 서버 오류</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "join successfully"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="로그인">
                    <h3>3.2. 로그인</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/auth/login</code></td></tr>
                        <tr><td>설명</td><td>사용자 ID와 비밀번호로 로그인하고 JWT 토큰을 발급받습니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "userId": "newUser123",
  "password": "password123!"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 로그인 성공<br>400: 잘못된 요청<br>401: 로그인 실패</td></tr>
                        <tr><td>응답 헤더</td><td>Authorization: Bearer {액세스 토큰}<br>Set-Cookie: refreshToken=xxxxxx; Path=/; Domain=your-cookie-domain.com; HttpOnly; Secure</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "access_token": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJuZXdVc2VyMTIzIiwicm9sZSI6WyJST0xFX1VTRVIiXSwiaWF0IjoxNzE1ODAwMDAwLCJleHAiOjE3MTU4MDE4MDB9.xxxx"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="프로필-이미지-업로드">
                    <h3>3.3. 프로필 이미지 업로드</h3>
                     <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/profileUpload</code></td></tr>
                        <tr><td>설명</td><td>사용자 프로필 이미지를 업로드하고 이미지 URL을 반환받습니다.</td></tr>
                        <tr><td>요청 본문</td><td>multipart/form-data 형식<br>profile: 이미지 파일</td></tr>
                        <tr><td>응답 코드</td><td>200: 업로드 성공<br>400: 잘못된 파일<br>500: 서버 오류</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "fileName": "https://your-file-server.com/attach/profile/xxxx_profile.jpg"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="사용자-id-중복-체크">
                    <h3>3.4. 사용자 ID 중복 체크</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/check/userId/IsDuplicate</code></td></tr>
                        <tr><td>설명</td><td>제공된 사용자 ID가 이미 사용 중인지 확인합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "userId": "newUser123"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 중복 체크 결과</td></tr>
                        <tr><td>응답 본문</td><td>boolean (true: 중복됨, false: 사용 가능)</td></tr>
                    </table>
                </article>
                <article id="닉네임-중복-체크">
                    <h3>3.5. 닉네임 중복 체크</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/check/nickname/IsDuplicate</code></td></tr>
                        <tr><td>설명</td><td>제공된 닉네임이 이미 사용 중인지 확인합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "nickname": "쾌활한다람쥐"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 중복 체크 결과</td></tr>
                        <tr><td>응답 본문</td><td>boolean (true: 중복됨, false: 사용 가능)</td></tr>
                    </table>
                </article>
                <article id="사용자-토큰-쿠키-정리">
                    <h3>3.6. 사용자 토큰 쿠키 정리 (로그아웃)</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/clean/userTokenCookie</code></td></tr>
                        <tr><td>설명</td><td>클라이언트의 refreshToken 쿠키를 만료시켜 제거합니다.</td></tr>
                        <tr><td>응답 코드</td><td>200: 쿠키 정리 성공</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "refreshToken deleted"
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="oauth2-api">
                <h2>4. OAuth2 API</h2>
                <article id="oauth2-소셜-로그인-콜백-처리">
                    <h3>4.1. OAuth2 소셜 로그인 콜백 처리</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/oauth2/callback/{provider}</code></td></tr>
                        <tr><td>설명</td><td>소셜 프로바이더로부터 인증 후 리디렉션되는 엔드포인트</td></tr>
                        <tr><td>경로 파라미터</td><td>provider: 소셜 로그인 프로바이더 (kakao, naver, google)</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "tempCode": "abcdef123456", // 소셜 프로바이더로부터 발급받은 임시 코드
  "state": "xyz789uvw" // CSRF 방어용 상태 값 (Naver 로그인 시 필요)
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 소셜 로그인 성공<br>400: 잘못된 요청<br>500: 서버 내부 오류</td></tr>
                        <tr><td>응답 헤더</td><td>Authorization: Bearer {액세스 토큰}<br>Set-Cookie: {provider}_refreshToken=xxxxxx; Path=/; Domain=your-cookie-domain.com; HttpOnly; Secure</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "access_token": "string",
  "userProfile": {
    // 사용자 프로필 정보
  }
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="이메일-api">
                <h2>5. 이메일 API</h2>
                <article id="이메일-인증-코드-발송">
                    <h3>5.1. 이메일 인증 코드 발송</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/emailSend</code></td></tr>
                        <tr><td>설명</td><td>회원가입 등을 위한 이메일 인증 코드를 발송합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "email": "user@example.com"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 이메일 전송 성공<br>400: 이미 가입된 이메일<br>500: 이메일 전송 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "A temporary code has been sent to your email"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="커스텀-이메일-발송">
                    <h3>5.2. 커스텀 이메일 발송 (관리자/내부용)</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/private/customEmailSend</code></td></tr>
                        <tr><td>설명</td><td>지정된 수신자에게 커스텀 제목과 내용으로 이메일을 발송합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "email": "user@example.com",
  "content": "이메일 내용",
  "title": "이메일 제목"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 이메일 전송 성공<br>400: 잘못된 요청<br>500: 이메일 전송 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "custom email send success"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="이메일-인증-코드-확인">
                    <h3>5.3. 이메일 인증 코드 확인</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/emailCheck</code></td></tr>
                        <tr><td>설명</td><td>발송된 이메일 인증 코드의 유효성을 확인합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "email": "user@example.com",
  "code": "A1B2C3D4"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>202: 이메일 코드 유효<br>401: 이메일 코드 무효</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "email code is valid"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="임시-비밀번호-이메일-전송-인증된-사용자">
                    <h3>5.4. 임시 비밀번호 이메일 전송 (인증된 사용자)</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/protected/sendEmailPassword</code></td></tr>
                        <tr><td>설명</td><td>현재 로그인된 사용자의 이메일로 임시 비밀번호를 발송합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>응답 코드</td><td>200: 임시 비밀번호 전송 성공<br>500: 임시 비밀번호 전송 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "A temporary password has been sent to your email"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="아이디로-이메일-찾아-임시-비밀번호-전송">
                    <h3>5.5. 아이디로 이메일 찾아 임시 비밀번호 전송</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/findPassWithEmail</code></td></tr>
                        <tr><td>설명</td><td>사용자 ID를 기반으로 등록된 이메일을 찾아 임시 비밀번호를 발송합니다.</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "userId": "newUser123"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 임시 비밀번호 전송 성공<br>500: 임시 비밀번호 전송 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "A temporary password has been sent to your email"
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="sse-api">
                <h2>6. SSE API</h2>
                <article id="sse-구독">
                    <h3>6.1. SSE (Server-Sent Events) 구독</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/protected/sse/subscribe</code></td></tr>
                        <tr><td>설명</td><td>서버로부터 실시간 이벤트 스트림을 구독합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>요청 헤더</td><td>Last-Event-ID: 마지막으로 수신한 이벤트 ID (선택적)</td></tr>
                        <tr><td>응답 코드</td><td>200: SSE 구독 성공<br>401: 인증 실패<br>500: 서버 오류</td></tr>
                        <tr><td>응답 형식</td><td>text/event-stream</td></tr>
                        <tr><td>응답 예시</td><td><pre><code>id: 123
event: INIT
data: {"message": "Subscription successful"}

id: 124
event: message
data: {"content": "New notification!"}</code></pre></td></tr>
                    </table>
                </article>
                <article id="특정-사용자에게-더미-sse-데이터-전송">
                    <h3>6.2. 특정 사용자에게 더미 SSE 데이터 전송 (테스트용)</h3>
                     <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/public/dummyData/{user_id}</code></td></tr>
                        <tr><td>설명</td><td>지정된 사용자 ID에게 SSE 이벤트를 발생시킵니다.</td></tr>
                        <tr><td>경로 파라미터</td><td>user_id: SSE 이벤트를 수신할 사용자의 ID</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "message": "Hello from server!"
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 더미 데이터 전송 성공<br>400: 잘못된 요청</td></tr>
                    </table>
                </article>
            </section>

            <section id="일기-api">
                <h2>7. 일기 API</h2>
                <article id="일기-작성">
                    <h3>7.1. 일기 작성</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries</code></td></tr>
                        <tr><td>설명</td><td>새로운 일기를 작성하고 저장합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "title": "오늘의 일기", // 선택적
  "content": "오늘은 정말 즐거운 하루였다." // 필수
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>201: 일기 작성 성공<br>400: 잘못된 요청<br>401: 인증 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "id": 1,
  "userId": 123,
  "title": "오늘의 일기",
  "content": "오늘은 정말 즐거운 하루였다.",
  "createdAt": "2023-05-01T12:00:00Z",
  "updatedAt": "2023-05-01T12:00:00Z"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="일기-목록-조회">
                    <h3>7.2. 일기 목록 조회</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries</code></td></tr>
                        <tr><td>설명</td><td>사용자가 작성한 일기 목록을 페이지네이션하여 조회합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>쿼리 파라미터</td><td>page: 페이지 번호 (기본값 0)<br>size: 페이지 당 항목 수 (기본값 10)<br>sort: 정렬 기준 (예: createdAt,desc)</td></tr>
                        <tr><td>응답 코드</td><td>200: 일기 목록 조회 성공<br>401: 인증 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "diaries": [
    {
      "id": 1,
      "title": "오늘의 일기",
      "createdAt": "2023-05-01T12:00:00Z",
      "emotionStatus": "POSITIVE"
    },
    // ... 추가 일기 항목
  ],
  "pageInfo": {
    "currentPage": 0,
    "totalPages": 5,
    "totalElements": 42
  }
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="특정-일기-상세-조회">
                    <h3>7.3. 특정 일기 상세 조회</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries/{diaryId}</code></td></tr>
                        <tr><td>설명</td><td>ID에 해당하는 특정 일기의 상세 내용과 연관된 감정 분석 결과를 함께 조회합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>경로 파라미터</td><td>diaryId: 조회할 일기의 ID</td></tr>
                        <tr><td>응답 코드</td><td>200: 일기 상세 조회 성공<br>401: 인증 실패<br>403: 접근 권한 없음<br>404: 일기를 찾을 수 없음</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "id": 1,
  "userId": 123,
  "title": "오늘의 일기",
  "content": "오늘은 정말 즐거운 하루였다.",
  "alternativeThoughtByAI": "오늘은 새로운 경험을 통해 성장한 하루였다.",
  "createdAt": "2023-05-01T12:00:00Z",
  "updatedAt": "2023-05-01T12:00:00Z",
  "analysis": {
    "id": 42,
    "emotionDetection": "기쁨 80%, 슬픔 10%, 놀람 5%, 평온 5%",
    "automaticThought": "나는 항상 실패한다.",
    "promptForChange": "정말 항상 실패했나요? 성공했던 경험을 떠올려볼까요?",
    "alternativeThought": "과거에 몇 번 실패했지만, 그것이 항상 실패한다는 의미는 아니다. 이번에는 다른 방법을 시도해볼 수 있다.",
    "status": "POSITIVE",
    "analyzedAt": "2023-05-01T12:05:00Z"
  }
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="특정-일기-수정">
                    <h3>7.4. 특정 일기 수정</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-put">PUT</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries/{diaryId}</code></td></tr>
                        <tr><td>설명</td><td>ID에 해당하는 특정 일기의 제목 또는 내용을 수정합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>경로 파라미터</td><td>diaryId: 수정할 일기의 ID</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "title": "수정된 일기 제목", // 선택적
  "content": "수정된 일기 내용" // 필수
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 일기 수정 성공<br>400: 잘못된 요청<br>401: 인증 실패<br>403: 접근 권한 없음<br>404: 일기를 찾을 수 없음</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "id": 1,
  "userId": 123,
  "title": "수정된 일기 제목",
  "content": "수정된 일기 내용",
  "createdAt": "2023-05-01T12:00:00Z",
  "updatedAt": "2023-05-01T13:30:00Z"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="특정-일기-삭제">
                    <h3>7.5. 특정 일기 삭제</h3>
                     <table>
                        <tr><td>메소드</td><td><span class="badge badge-delete">DELETE</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries/{diaryId}</code></td></tr>
                        <tr><td>설명</td><td>ID에 해당하는 특정 일기를 삭제합니다. 연관된 감정 분석 결과도 함께 삭제됩니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>경로 파라미터</td><td>diaryId: 삭제할 일기의 ID</td></tr>
                        <tr><td>응답 코드</td><td>200/204: 일기 삭제 성공<br>401: 인증 실패<br>403: 접근 권한 없음<br>404: 일기를 찾을 수 없음</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "Diary deleted successfully"
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="감정-분석-api">
                <h2>8. 감정 분석 API</h2>
                <article id="일기-감정-분석-요청">
                    <h3>8.1. 일기 감정 분석 요청 (비동기)</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-post">POST</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries/{diaryId}/analysis</code></td></tr>
                        <tr><td>설명</td><td>특정 일기에 대한 AI 감정 분석을 비동기적으로 요청합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>경로 파라미터</td><td>diaryId: 감정 분석을 요청할 일기의 ID</td></tr>
                        <tr><td>응답 코드</td><td>202: 분석 요청 성공<br>401: 인증 실패<br>403: 접근 권한 없음<br>404: 일기를 찾을 수 없음<br>409: 이미 분석 중이거나 완료됨</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "Emotion analysis request accepted. Processing in background.",
  "diaryId": 1,
  "trackingId": "kafka-message-id-12345"
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="일기-감정-분석-결과-조회">
                    <h3>8.2. 일기 감정 분석 결과 조회</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/diaries/{diaryId}/analysis</code></td></tr>
                        <tr><td>설명</td><td>특정 일기의 AI 감정 분석 결과를 조회합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>경로 파라미터</td><td>diaryId: 감정 분석 결과를 조회할 일기의 ID</td></tr>
                        <tr><td>응답 코드</td><td>200: 분석 결과 조회 성공<br>202: 분석 진행 중<br>401: 인증 실패<br>403: 접근 권한 없음<br>404: 일기 또는 분석 결과를 찾을 수 없음</td></tr>
                        <tr><td>응답 본문 (200)</td><td><pre><code>{
  "diaryId": 1,
  "analysis": {
    "id": 42,
    "emotionDetection": "기쁨 80%, 슬픔 10%, 놀람 5%, 평온 5%",
    "automaticThought": "나는 항상 실패한다.",
    "promptForChange": "정말 항상 실패했나요? 성공했던 경험을 떠올려볼까요?",
    "alternativeThought": "과거에 몇 번 실패했지만, 그것이 항상 실패한다는 의미는 아니다. 이번에는 다른 방법을 시도해볼 수 있다.",
    "status": "POSITIVE",
    "analyzedAt": "2023-05-01T12:05:00Z"
  }
}</code></pre></td></tr>
                        <tr><td>응답 본문 (202)</td><td><pre><code>{
  "message": "Analysis is still in progress.",
  "diaryId": 1
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="설정-api">
                <h2>9. 설정 API</h2>
                <article id="사용자-설정-조회">
                    <h3>9.1. 사용자 설정 조회</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-get">GET</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/settings</code></td></tr>
                        <tr><td>설명</td><td>현재 로그인된 사용자의 커스텀 설정 및 기본 애플리케이션 설정을 조회합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>응답 코드</td><td>200: 설정 조회 성공<br>401: 인증 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "settings": [
    {
      "settingKey": "notification.enabled",
      "value": true,
      "dataType": "BOOLEAN",
      "description": "알림 활성화 여부",
      "isUserEditable": true
    },
    {
      "settingKey": "theme.color",
      "value": "dark",
      "dataType": "STRING",
      "description": "앱 테마 색상",
      "isUserEditable": true
    },
    // ... 추가 설정 항목
  ]
}</code></pre></td></tr>
                    </table>
                </article>
                <article id="사용자-설정-수정">
                    <h3>9.2. 사용자 설정 수정</h3>
                    <table>
                        <tr><td>메소드</td><td><span class="badge badge-put">PUT</span></td></tr>
                        <tr><td>엔드포인트</td><td><code>/api/settings</code></td></tr>
                        <tr><td>설명</td><td>현재 로그인된 사용자의 특정 설정을 수정합니다.</td></tr>
                        <tr><td>인증</td><td>Bearer Token 필요</td></tr>
                        <tr><td>요청 본문</td><td><pre><code>{
  "settingsToUpdate": [
    {
      "settingKey": "notification.enabled",
      "newValue": false
    },
    {
      "settingKey": "theme.color",
      "newValue": "light"
    }
    // ... 추가 수정할 설정
  ]
}</code></pre></td></tr>
                        <tr><td>응답 코드</td><td>200: 설정 수정 성공<br>400: 잘못된 요청<br>401: 인증 실패</td></tr>
                        <tr><td>응답 본문</td><td><pre><code>{
  "message": "Settings updated successfully",
  "updatedSettings": [
    {
      "settingKey": "notification.enabled",
      "value": false
    },
    {
      "settingKey": "theme.color",
      "value": "light"
    }
  ]
}</code></pre></td></tr>
                    </table>
                </article>
            </section>

            <section id="데이터-모델">
                <h2>10. 데이터 모델</h2>
                <article id="인증-및-사용자-모델">
                    <h3>10.1. 인증 및 사용자 모델</h3>
                    <table>
                        <thead><tr><th>모델</th><th>설명</th><th>주요 필드</th></tr></thead>
                        <tbody>
                            <tr><td>JoinRequest</td><td>회원가입 요청</td><td>userId, userPw, userName, nickname, phone, gender, code(이메일 인증 코드) 등</td></tr>
                            <tr><td>LoginRequest</td><td>로그인 요청</td><td>userId, password</td></tr>
                            <tr><td>LoginResponse</td><td>로그인 응답</td><td>access_token</td></tr>
                            <tr><td>TokenRefreshRequest</td><td>토큰 갱신 요청</td><td>expiredToken, provider</td></tr>
                            <tr><td>TokenRefreshResponse</td><td>토큰 갱신 응답</td><td>access_token</td></tr>
                            <tr><td>OAuth2CallbackRequest</td><td>OAuth2 콜백 요청</td><td>tempCode, state</td></tr>
                            <tr><td>OAuth2LoginResponse</td><td>OAuth2 로그인 응답</td><td>access_token, userProfile</td></tr>
                        </tbody>
                    </table>
                </article>
                <article id="이메일-모델">
                    <h3>10.2. 이메일 모델</h3>
                    <table>
                        <thead><tr><th>모델</th><th>설명</th><th>주요 필드</th></tr></thead>
                        <tbody>
                            <tr><td>EmailRequest</td><td>이메일 요청</td><td>email</td></tr>
                            <tr><td>EmailSendResponse</td><td>이메일 전송 응답</td><td>message</td></tr>
                            <tr><td>CustomEmailRequest</td><td>커스텀 이메일 요청</td><td>email, content, title</td></tr>
                            <tr><td>EmailCheckDto</td><td>이메일 확인 요청</td><td>email, code</td></tr>
                            <tr><td>EmailCheckResponse</td><td>이메일 확인 응답</td><td>message</td></tr>
                        </tbody>
                    </table>
                </article>
                <article id="일기-및-분석-모델">
                    <h3>10.3. 일기 및 분석 모델</h3>
                    <table>
                        <thead><tr><th>모델</th><th>설명</th><th>주요 필드</th></tr></thead>
                        <tbody>
                            <tr><td>DiaryCreateRequest</td><td>일기 생성 요청</td><td>title, content</td></tr>
                            <tr><td>DiaryResponse</td><td>일기 응답</td><td>id, userId, title, content, createdAt, updatedAt</td></tr>
                            <tr><td>DiaryUpdateRequest</td><td>일기 수정 요청</td><td>title, content</td></tr>
                            <tr><td>DiaryListItem</td><td>일기 목록 항목</td><td>id, title, createdAt, emotionStatus</td></tr>
                            <tr><td>DiaryDetailResponse</td><td>일기 상세 응답</td><td>id, userId, title, content, alternativeThoughtByAI, createdAt, updatedAt, analysis</td></tr>
                            <tr><td>DiaryAnalysisResult</td><td>일기 분석 결과</td><td>id, emotionDetection, automaticThought, promptForChange, alternativeThought, status, analyzedAt</td></tr>
                            <tr><td>DiaryAnalysisRequestResponse</td><td>일기 분석 요청 응답</td><td>message, diaryId, trackingId</td></tr>
                        </tbody>
                    </table>
                </article>
                <article id="설정-모델">
                    <h3>10.4. 설정 모델</h3>
                    <table>
                        <thead><tr><th>모델</th><th>설명</th><th>주요 필드</th></tr></thead>
                        <tbody>
                            <tr><td>SettingItem</td><td>설정 항목</td><td>settingKey, value, dataType, description, isUserEditable</td></tr>
                            <tr><td>SettingsListResponse</td><td>설정 목록 응답</td><td>settings</td></tr>
                            <tr><td>SettingsUpdateRequestItem</td><td>설정 수정 요청 항목</td><td>settingKey, newValue</td></tr>
                            <tr><td>SettingsUpdateRequest</td><td>설정 수정 요청</td><td>settingsToUpdate</td></tr>
                            <tr><td>SettingsUpdateResponse</td><td>설정 수정 응답</td><td>message, updatedSettings</td></tr>
                        </tbody>
                    </table>
                </article>
                <article id="오류-모델">
                    <h3>10.5. 오류 모델</h3>
                    <table>
                        <thead><tr><th>모델</th><th>설명</th><th>주요 필드</th></tr></thead>
                        <tbody>
                            <tr><td>ErrorResponse</td><td>오류 응답</td><td>timestamp, status, error, message, path</td></tr>
                        </tbody>
                    </table>
                </article>
            </section>
        </main>
        <div style="clear:both;"></div>
    </div>

    <footer class="text-center p-8 mt-12 border-t border-gray-200 text-gray-500">
        마음 일기 API 명세서 &copy; 2024
    </footer>

    <script>
        // JavaScript for dynamic TOC and Scrollspy
        document.addEventListener('DOMContentLoaded', function () {
            const tocList = document.getElementById('toc-list');
            const topNav = document.getElementById('top-nav');
            const sections = document.querySelectorAll('main section');
            const articles = document.querySelectorAll('main article'); // For more granular TOC

            // Populate TOC
            sections.forEach((section, sectionIndex) => {
                const sectionTitleElement = section.querySelector('h2');
                if (!sectionTitleElement) return;

                const sectionTitle = sectionTitleElement.textContent;
                const sectionId = section.id;

                const sectionListItem = document.createElement('li');
                sectionListItem.classList.add('toc-item', 'mb-2');
                const sectionLink = document.createElement('a');
                sectionLink.href = `#${sectionId}`;
                sectionLink.textContent = sectionTitle;
                sectionLink.classList.add('block', 'hover:text-blue-600', 'transition-colors');
                sectionListItem.appendChild(sectionLink);
                
                // Top navigation link for main sections
                const topNavLink = document.createElement('a');
                topNavLink.href = `#${sectionId}`;
                topNavLink.textContent = sectionTitle.split('. ')[1]; // Get title without number
                topNav.appendChild(topNavLink);


                const subList = document.createElement('ul');
                subList.classList.add('ml-4', 'mt-1');

                const sectionArticles = section.querySelectorAll('article');
                sectionArticles.forEach((article, articleIndex) => {
                    const articleTitleElement = article.querySelector('h3');
                    if (!articleTitleElement) return;

                    const articleTitle = articleTitleElement.textContent;
                    const articleId = article.id;

                    const articleListItem = document.createElement('li');
                    articleListItem.classList.add('toc-item', 'mb-1');
                    const articleLink = document.createElement('a');
                    articleLink.href = `#${articleId}`;
                    articleLink.textContent = articleTitle;
                    articleLink.classList.add('text-sm', 'text-gray-600', 'hover:text-blue-500', 'transition-colors');
                    articleListItem.appendChild(articleLink);
                    subList.appendChild(articleListItem);
                });

                if (subList.children.length > 0) {
                    sectionListItem.appendChild(subList);
                }
                tocList.appendChild(sectionListItem);
            });

            // Scrollspy
            const tocLinks = document.querySelectorAll('.toc-item a');
            const topNavLinks = document.querySelectorAll('#top-nav a');
            const allNavLinks = Array.from(tocLinks).concat(Array.from(topNavLinks));

            const observerCallback = (entries) => {
                entries.forEach(entry => {
                    const id = entry.target.getAttribute('id');
                    const correspondingTocLink = document.querySelector(`.toc-item a[href="#${id}"]`);
                    const correspondingTopNavLink = document.querySelector(`#top-nav a[href="#${id}"]`);

                    if (entry.isIntersecting) {
                        allNavLinks.forEach(link => link.classList.remove('active'));
                        if (correspondingTocLink) correspondingTocLink.parentElement.classList.add('active');
                        if (correspondingTopNavLink) correspondingTopNavLink.classList.add('active');
                    } else {
                         if (correspondingTocLink) correspondingTocLink.parentElement.classList.remove('active');
                         if (correspondingTopNavLink) correspondingTopNavLink.classList.remove('active');
                    }
                });
            };

            const observerOptions = {
                rootMargin: '-20% 0px -70% 0px', // Adjust to highlight when section is in the middle part of viewport
                threshold: 0.1
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);
            document.querySelectorAll('main section[id], main article[id]').forEach(el => observer.observe(el));
        });
    </script>
</body>
</html>
