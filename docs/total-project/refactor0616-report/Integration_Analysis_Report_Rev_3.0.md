# CBT Project Integration Analysis Report (Rev. 3.0)

## 1. Architecture Recommendation
# Architecture Recommendation Report: Auth-Server & CBT-back-diary

## 1. Introduction

This report provides an architectural recommendation for the integration or separation of the `Auth-Server` and `CBT-back-diary` projects. The recommendation is based on a detailed analysis of their entities, service layers, data access layers, and build/configuration files, as documented in:

*   `entity_comparison_report.md`
*   `service_layer_comparison_report.md`
*   `data_access_layer_comparison_report.md`
*   `dependency_config_comparison_report.md`

The goal is to determine the most suitable architectural approach (monolith or microservices) considering data coupling, technical stack alignment, operational capacity, and future maintainability.

## 2. Summary of Key Comparative Findings

From the previous analysis reports, the following key points are critical for this decision:

*   **Entity Duplication & Coupling:**
    *   Core entities like `User`, `AuthProvider`, and `Diary` are present in both projects, with significant overlap in the `User` and `AuthProvider` entities.
    *   `CBT-back-diary`'s `Diary` entity has a strong dependency on a `User` entity (foreign key `user_id`).
    *   Auth-Server also contains a `Diary` entity, `Report` entity, and `DiaryReportLink`, suggesting it might already handle or be designed to handle diary-related functionalities beyond basic authentication.

*   **Service Layer Functionality:**
    *   `Auth-Server` possesses a more comprehensive user management and authentication system, including OAuth2 integration (`Oauth2Service`), JWT management (`TokenService`), and Spring Security integration (`PrincipalDetailService`). Its `UserService` handles registration, password updates, and duplication checks.
    *   `CBT-back-diary`'s `UserService` is currently minimal, primarily focused on retrieving (mocked) user details. Its `DiaryService` handles CRUD operations for diaries, currently using a mock user ID.

*   **Data Access Layer:**
    *   `Auth-Server` utilizes QueryDSL for some custom user repository methods, indicating a more complex data access pattern for user management.
    *   `CBT-back-diary` relies on Spring Data JPA derived queries and JPQL.
    *   Both use MariaDB, but configuration practices differ (externalized vs. hardcoded).

*   **Technical Stack & Dependencies:**
    *   **Java Version:** Auth-Server (Java 21) vs. CBT-back-diary (Java 17).
    *   **Spring Boot Version:** Auth-Server (3.2.4) vs. CBT-back-diary (3.2.0). Both are on 3.x, which is good.
    *   **Key Libraries:**
        *   Auth-Server uses QueryDSL, Redis (for token management), and JWT libraries.
        *   The specified `build.gradle` for CBT-back-diary does *not* explicitly include Redis or JWT dependencies.
    *   **JPA `ddl-auto`:** Auth-Server uses `none` (safer for production, schema managed externally), while CBT-back-diary uses `update` (convenient for development).

## 3. Evaluation of Architectural Approaches

### 3.1. Monolith Integration

Integrating `CBT-back-diary` functionality into `Auth-Server` (or vice-versa, though Auth-Server appears more feature-complete as a base).

**Pros:**

*   **Reduced Duplication:** Eliminates redundant `User` and `AuthProvider` entities and potentially overlapping user management logic. The existing `Diary` entity in Auth-Server could be enhanced or replaced by CBT-back-diary's version.
*   **Simplified Data Consistency:** A single database for user and diary data ensures strong transactional consistency and avoids complex data synchronization mechanisms between services.
*   **Reduced Latency:** Direct method calls within the monolith are faster than inter-service API calls for operations requiring both user and diary data.
*   **Simplified Development & Deployment (Initially):** A single codebase can be easier to manage, build, and deploy, especially for smaller teams or in early project stages.
*   **Leverage Auth-Server's Strengths:** CBT-back-diary functionality can directly benefit from Auth-Server's mature authentication, authorization (OAuth2, JWT, Redis-based token management), and user management features, including QueryDSL for complex queries if needed.
*   **Atomic Transactions:** Operations spanning user and diary data can be handled within single database transactions, ensuring data integrity.

**Cons:**

*   **Technical Integration Effort:**
    *   Merging different Java versions (21 vs. 17) requires standardizing on one, likely Java 21.
    *   Aligning Spring Boot versions (3.2.4 vs. 3.2.0) is minor but necessary.
    *   Integrating CBT-back-diary's `Diary` entity and service logic into Auth-Server's structure, potentially resolving conflicts if Auth-Server's `Diary` entity has different fields or purposes.
    *   Deciding on a unified `ddl-auto` policy (preferably `none` or `validate` for production, using migrations).
    *   If CBT-back-diary's functionalities are brought into Auth-Server, they will implicitly use QueryDSL, Redis, and JWT where appropriate, which might be an increase in complexity for the diary-specific code if it was designed to be simpler.
*   **Increased Application Complexity:** The resulting monolith will be larger and more complex, potentially increasing build times and making it harder for developers to understand the entire system.
*   **Scalability Challenges:** Scaling specific parts of the application (e.g., diary service vs. auth service) independently becomes more difficult. The entire application must be scaled together.
*   **Deployment Rigidity:** A change in any part of the monolith requires redeploying the entire application.
*   **Loss of Simplicity for CBT-back-diary:** If CBT-back-diary was intended as a very simple, focused service, merging it into the more complex Auth-Server might be seen as a drawback.

### 3.2. Microservices Separation

Maintaining `Auth-Server` and `CBT-back-diary` as separate services that communicate via APIs.

**Pros:**

*   **Separation of Concerns:** Clear boundaries between authentication/user management and diary functionalities.
*   **Independent Development & Deployment:** Teams can work on, update, and deploy each service independently, leading to faster development cycles for individual services.
*   **Technology Diversity (Potentially):** While both are Spring Boot, this architecture allows for more divergence in specific library versions or even languages in the long run if needed (though not ideal for current stack). The Java 17 vs 21 difference is less of an immediate blocker.
*   **Independent Scalability:** Each service can be scaled based on its specific load requirements.
*   **Fault Isolation:** An issue in one service is less likely to bring down the other (if designed for resilience).
*   **CBT-back-diary Simplicity:** CBT-back-diary can remain focused and potentially simpler if it offloads all user management to Auth-Server via API calls.

**Cons:**

*   **Inter-Service Communication Overhead:** API calls between services (e.g., DiaryService calling Auth-Server to validate a user token or fetch user details) introduce network latency and complexity.
*   **Data Consistency Challenges:** Maintaining consistency for data that might be referenced or partially duplicated (like user information needed by the Diary service) across services is complex. Eventual consistency models might be needed.
*   **Duplicated Models/DTOs:** `User` information (even if just IDs or basic profile data) would need to be represented in `CBT-back-diary`, potentially leading to duplicated DTOs or shared client libraries. If `User` entity structure diverges, synchronization becomes an issue.
*   **Distributed Transactions:** Managing transactions that span multiple services is significantly more complex than local transactions in a monolith.
*   **Operational Complexity:** Managing, monitoring, and debugging multiple services is generally more complex than a single application. Requires service discovery, load balancing, resilient communication patterns (e.g., circuit breakers).
*   **API Contract Management:** Requires well-defined and versioned APIs between services. Changes in Auth-Server's API could break CBT-back-diary.
*   **Security:** Securing inter-service communication adds another layer of complexity.

## 4. Recommendation

**Recommendation: Monolith Integration, using Auth-Server as the base.**

**Justification:**

1.  **Strong Data Coupling:** The `Diary` functionality in `CBT-back-diary` is inherently tied to the `User` entity. Operations like creating, retrieving, or updating diaries almost always require user context and authorization. Managing this relationship across microservices would introduce significant complexity in terms of API calls, data synchronization, and transactional integrity. Auth-Server already has its own `Diary` entity, suggesting an intended or existing capability to manage diary-like data tied to users.
2.  **Core Functionality Centralization:** `Auth-Server` provides a more mature and feature-rich platform for user management, authentication (OAuth2, JWT), and authorization. Integrating `CBT-back-diary` into this existing framework allows the diary features to leverage these robust services directly, rather than `CBT-back-diary` having to reimplement or make numerous calls to an external auth service.
3.  **Reduced Operational Complexity (for the current scale):** While microservices offer scalability benefits, the current setup suggests two closely related domains. For the likely scale of this application, managing a single, well-structured monolith can be operationally simpler than managing two microservices with the attendant complexities of distributed systems.
4.  **Technical Stack Alignment:**
    *   Both projects use Spring Boot and MariaDB. The Spring Boot versions (3.2.4 and 3.2.0) are very close and on the same major version (3.x), making dependency management within a monolith feasible.
    *   The Java version difference (21 vs. 17) is manageable by standardizing on Java 21.
    *   Auth-Server's existing use of Redis and JWT provides a ready-made infrastructure for session management and secure APIs that the diary features can benefit from. CBT-back-diary would need to add these if it were to operate securely and efficiently as a separate service relying on Auth-Server.
5.  **Addressing Duplication:** A monolithic approach directly addresses the duplication of `User` and `AuthProvider` entities and associated logic.
6.  **Auth-Server's Existing Diary-Related Entities:** The presence of `Diary`, `Report`, and `DiaryReportLink` entities in Auth-Server suggests that it's already designed or evolving to handle functionalities beyond pure authentication. Merging CBT-back-diary's specific diary features could be seen as an extension or refinement of this existing domain within Auth-Server.

**Integration Strategy (if Monolith is chosen):**

*   **Base Project:** `Auth-Server` should serve as the base project due to its more comprehensive security and user management infrastructure.
*   **Merge `Diary` Functionality:**
    *   Carefully analyze the `Diary` entity from `CBT-back-diary` and compare it with `Auth-Server`'s `Diary` entity. Decide on a unified `Diary` model, incorporating the best aspects of both. If `CBT-back-diary`'s `Diary` is more feature-rich for its specific purpose, its fields and relationships can be merged into or replace Auth-Server's `Diary` entity.
    *   Migrate the `DiaryService` logic from `CBT-back-diary` into `Auth-Server`, adapting it to use Auth-Server's `User` entity and security context directly.
    *   Repositories related to Diary (`DiaryRepository`) would be added or merged into Auth-Server.
*   **Configuration Alignment:**
    *   Standardize on Java 21 and Spring Boot 3.2.4 (or the latest stable 3.x version).
    *   Adopt Auth-Server's `ddl-auto=none` policy and implement database migrations (e.g., using Flyway or Liquibase) for schema changes.
    *   Consolidate `application.properties`, likely using Auth-Server's externalized configuration approach as a model.
*   **Dependency Management:** Ensure all necessary dependencies from `CBT-back-diary` (if any not already in Auth-Server) are added to Auth-Server's `build.gradle`. CBT-back-diary's `build.gradle` would effectively be superseded.

**Considerations for Microservices (if Monolith is not chosen):**

If, despite the recommendation, a microservices approach is pursued, the following would be critical:

*   **API Contracts:** Define clear, versioned API contracts between Auth-Server and CBT-back-diary for user authentication, authorization, and retrieval of necessary user information.
*   **Shared User Model:** Create a shared library or clear DTOs for user representation to avoid inconsistencies.
*   **Authentication Flow:** CBT-back-diary would need to implement robust client-side logic to interact with Auth-Server for token validation and user context. This would likely involve adding JWT and potentially OAuth client libraries to CBT-back-diary.
*   **Data Synchronization:** Strategies for handling user data that might be needed locally in CBT-back-diary (e.g., for foreign key constraints or local caching) would need careful consideration to avoid staleness.

Given the tight coupling around user data and the existing comprehensive features in Auth-Server, merging into a monolith appears to be the more pragmatic and efficient approach for these two components at their current stage.

---
## 2. Domain Model and Entity Duplication Analysis
# Entity Comparison Report

This report compares entities from the `Auth-Server` and `CBT-back-diary` projects.

## Entities with Same or Similar Names

| Feature             | User (Auth-Server)                                                                                                | User (CBT-back-diary)                                                                                                                                                              | Differences / Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------- | ----------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Entity Name**     | `User`                                                                                                            | `User`                                                                                                                                                                             | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Project**         | Auth-Server                                                                                                       | CBT-back-diary                                                                                                                                                                     | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Purpose**         | Represents a user in the system.                                                                                  | Represents a user in the system.                                                                                                                                                   | Same fundamental purpose.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Fields**          |                                                                                                                   |                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `id`                | `Long`, `@Id`, `@GeneratedValue(strategy = GenerationType.IDENTITY)`                                              | `Long`, `@Id`, `@GeneratedValue(strategy = GenerationType.IDENTITY)`, `@Column(name = "id", updatable = false, nullable = false)`                                                    | CBT-back-diary explicitly defines `@Column`. Both are identity generated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `password`          | `String`, `@Column(nullable = false)`                                                                             | `String`, `@Column(name = "password", nullable = false)`                                                                                                                           | CBT-back-diary explicitly names the column.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `email`             | `String`, `@Column(name = "email", nullable = false, length = 255, unique = true)`                                | `String`, `@Column(name = "email", unique = true, nullable = false)`                                                                                                               | Auth-Server specifies length 255.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `userName`          | `String`, `@Column(name = "user_name", nullable = false, length = 50, unique = true)`                             | `String`, `@Column(name = "user_name", unique = true, nullable = false, length = 50)`                                                                                              | Same. In CBT-back-diary, maps to `nickname` in DTO.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `createdAt`         | `LocalDateTime`, `@Column(name = "created_at", nullable = false, updatable = false)`                               | `LocalDateTime`, `@Builder.Default`, `@Column(name = "created_at", updatable = false, nullable = false, columnDefinition = "TIMESTAMP DEFAULT CURRENT_TIMESTAMP")` (default now) | CBT-back-diary uses `@Builder.Default` and `columnDefinition` for DB default. Auth-Server sets via `@PrePersist`.                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `updatedAt`         | `LocalDateTime`, `@Column(name = "updated_at", nullable = false)`                                                 | `LocalDateTime`, `@Builder.Default`, `@Column(name = "updated_at", nullable = false, columnDefinition = "TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")` (default now) | CBT-back-diary uses `@Builder.Default` and `columnDefinition` for DB default & update. Auth-Server sets via `@PrePersist` and `@PreUpdate`.                                                                                                                                                                                                                                                                                                                                                                                            |
| `lastLogin`         | `LocalDateTime`, `@Column(name = "last_login")`                                                                   | `LocalDateTime`, `@Column(name = "last_login")`                                                                                                                                    | Same.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `userRole`          | `String`, `@Builder.Default` "USER", `@Column(name = "user_role", nullable = false, length = 20)`                   | `String`, `@Column(name = "user_role", nullable = false, length = 20)` (In DTO `role`)                                                                                             | Auth-Server has `@Builder.Default` "USER". CBT-back-diary does not specify a Java-level default but implies it would be set.                                                                                                                                                                                                                                                                                                                                                                                                     |
| `isPremium`         | `Boolean`, `@Builder.Default` false, `@Column(name = "is_premium", nullable = false)`                               | `boolean`, `@Builder.Default` false, `@Column(name = "is_premium", nullable = false)`                                                                                                | Auth-Server uses `Boolean` (object wrapper), CBT-back-diary uses `boolean` (primitive). Both default to `false`.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `isActive`          | `String`, `@Builder.Default` "ACTIVE", `@Column(name = "is_active", nullable = false, length = 20)`                 | `String`, `@Builder.Default` "ACTIVE", `@Column(name = "is_active", nullable = false, length = 20)`                                                                                 | Same.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Relationships**   |                                                                                                                   |                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `diaries`           | `List<Diary>`, `@OneToMany(mappedBy = "user")`                                                                     | Not present directly. Implied relationship via `Diary.user`.                                                                                                                       | Auth-Server defines the owning side of the relationship from User to Diary. CBT-back-diary implies it from Diary's perspective.                                                                                                                                                                                                                                                                                                                                                                                                      |
| `authentications`   | `List<UserAuthentication>`, `@OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)`       | Not present directly. Implied relationship via `UserAuthentication.user`.                                                                                                          | Auth-Server defines the owning side. CBT-back-diary implies it from `UserAuthentication`'s perspective.                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `customSettings`    | `List<UserCustomSetting>`, `@OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)`      | N/A (No `UserCustomSetting` entity in CBT-back-diary)                                                                                                                              | Auth-Server has user settings functionality.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Other**           | `@PrePersist`, `@PreUpdate`                                                                                       | `@PrePersist`, `@PreUpdate`, `getNickname()`, `getRole()`                                                                                                                            | CBT-back-diary has DTO mapping helper methods. Both manage `createdAt` and `updatedAt` via lifecycle callbacks, though CBT-back-diary also uses DB defaults.                                                                                                                                                                                                                                                                                                                                                                   |

| Feature             | AuthProvider (Auth-Server)                                                                                           | AuthProvider (CBT-back-diary)                                                                                                   | Differences / Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ------------------- | -------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Entity Name**     | `AuthProvider`                                                                                                       | `AuthProvider`                                                                                                                | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Project**         | Auth-Server                                                                                                          | CBT-back-diary                                                                                                                | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Purpose**         | Represents an authentication provider.                                                                               | Represents an authentication provider.                                                                                        | Same fundamental purpose.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Fields**          |                                                                                                                      |                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `id`                | `Integer id; @Id @GeneratedValue(strategy = GenerationType.IDENTITY)`                                              | `Integer id; @Id @GeneratedValue(strategy = GenerationType.IDENTITY) @Column(name = "id", updatable = false, nullable = false)` | CBT-back-diary explicitly defines `@Column`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `providerName`      | `String providerName; @Column(name = "provider_name", nullable = false, length = 50, unique = true)`                         | `String providerName; @Column(name = "provider_name", unique = true, nullable = false, length = 50)`                           | Same.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `description`       | `String description; @Column(nullable = true)`                                                                             | `String description; @Column(name = "description")`                                                                             | CBT-back-diary explicitly names the column.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `isActive`          | `Boolean isActive = true; @Builder.Default @Column(name = "is_active", nullable = false)`                                  | `boolean isActive = true; @Builder.Default @Column(name = "is_active", nullable = false)`                                       | Auth-Server uses `Boolean` (object wrapper), CBT-back-diary uses `boolean` (primitive). Both default to `true`.                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Relationships**   |                                                                                                                      |                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `userAuthentications` | `List<UserAuthentication> userAuthentications = new ArrayList<>(); @OneToMany(mappedBy = "authProvider", cascade = CascadeType.ALL) @Builder.Default` | Not present.                                                                                                                    | Auth-Server defines the owning side of the relationship. CBT-back-diary implies it from `UserAuthentication`'s perspective.                                                                                                                                                                                                                                                                                                                                                                                                                   |

| Feature             | UserAuthentication (Auth-Server)                                                                                                                                                                                                                                                                                             | UserAuthentication (CBT-back-diary)                                                                                                                                                                                                                                                                                                                                                         | Differences / Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Entity Name**     | `UserAuthentication`                                                                                                                                                                                                                                                                                                         | `UserAuthentication`                                                                                                                                                                                                                                                                                                                                                                        | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Project**         | Auth-Server                                                                                                                                                                                                                                                                                                                  | CBT-back-diary                                                                                                                                                                                                                                                                                                                                                                              | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Purpose**         | Links user to an auth provider.                                                                                                                                                                                                                                                                                              | Links user to an auth provider.                                                                                                                                                                                                                                                                                                                                                             | Same fundamental purpose.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Primary Key**     | `@EmbeddedId` (`UserAuthenticationId` class with `userId`, `authProviderId`)                                                                                                                                                                                                                                                   | `@IdClass(UserAuthenticationId.class)` (Separate `UserAuthenticationId` class with `user` (Long), `authProvider` (Integer)). Fields `user` and `authProvider` are marked with `@Id`.                                                                                                                                                                                                          | Both use composite keys. Auth-Server uses `@EmbeddedId` with a separate embeddable class for the ID. CBT-back-diary uses `@IdClass` with a separate ID class and marks the corresponding entity fields with `@Id`. The fields in `UserAuthenticationId` of CBT-back-diary are `Long user` and `Integer authProvider` directly referring to the types of the related entities' IDs. Auth-Server's `UserAuthenticationId` (not shown but implied by `@MapsId`) would also contain fields mapping to `User` and `AuthProvider` IDs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
| `socialId`          | `String socialId; @Column(name = "social_id", nullable = false, length = 255)`                                                                                                                                                                                                                                                              | `String socialId; @Column(name = "social_id", nullable = false)`                                                                                                                             | Auth-Server specifies length.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `createdAt`         | `LocalDateTime createdAt; @Column(name = "created_at", nullable = false)`                                                                                                                                                                                                                                                                           | `LocalDateTime createdAt; @Builder.Default private LocalDateTime createdAt = LocalDateTime.now(); @Column(name = "created_at", updatable = false, nullable = false, columnDefinition = "TIMESTAMP DEFAULT CURRENT_TIMESTAMP")` | Auth-Server sets via `@PrePersist`. CBT-back-diary uses `@Builder.Default` and DB default.                                                                                                                                                                                                                                                                                                                                     